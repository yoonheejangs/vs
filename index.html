<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptCraft 7.5 - PECS Research Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        body { font-family: 'Noto Sans KR', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .card { background-color: #1e293b; border-radius: 1rem; border: 1px solid #334155; padding: 1.5rem; }
        .btn-primary { background-color: #a3e635; color: #0f172a; font-weight: bold; padding: 0.75rem 1.5rem; border-radius: 0.5rem; transition: all 0.2s; }
        .btn-primary:hover { background-color: #bef264; transform: translateY(-2px); }
        .btn-primary:disabled { background-color: #4b5563; color: #9ca3af; cursor: not-allowed; transform: none; }
        
        /* Domain Tabs */
        .domain-tab { padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.85rem; transition: all 0.2s; border: 1px solid transparent; }
        .domain-tab:hover { background-color: #334155; }
        .domain-tab.active { background-color: #3b82f6; color: white; border-color: #60a5fa; font-weight: bold; }

        /* Level Tabs */
        .level-tab { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; transition: all 0.2s; }
        .level-tab.active { background-color: #a3e635; color: black; font-weight: bold; }
        .level-tab.inactive { background-color: #334155; color: #94a3b8; }

        /* Mind Map Node Styles (Lv 1) */
        .mindmap-node {
            background-color: #334155; color: #e2e8f0; padding: 0.75rem 1rem; border-radius: 0.75rem; 
            font-size: 0.85rem; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #475569; text-align: left; width: 100%; position: relative; z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .mindmap-node:hover { background-color: #475569; transform: translateX(5px); border-color: #94a3b8; }
        .mindmap-node.active { 
            background-color: #a3e635; color: #0f172a; border-color: #bef264; font-weight: bold; 
            box-shadow: 0 0 15px rgba(163, 230, 53, 0.4); transform: scale(1.05);
        }
        .mindmap-node::after {
            content: ''; position: absolute; top: 50%; right: -6px; width: 10px; height: 10px; 
            background: #475569; border-radius: 50%; transform: translateY(-50%); transition: background 0.3s;
        }
        .mindmap-node.active::after { background: #fff; border: 2px solid #a3e635; }
        
        .mindmap-col { display: flex; flex-direction: column; gap: 10px; width: 32%; min-width: 200px; transition: all 0.5s; }
        .mindmap-col.blur-col { opacity: 0.3; pointer-events: none; filter: blur(1px); }
        
        /* Guide Bubble */
        .guide-bubble {
            background: #a3e635; color: #0f172a; padding: 10px 15px; border-radius: 15px;
            font-weight: bold; font-size: 0.9rem; position: relative; box-shadow: 0 4px 12px rgba(163, 230, 53, 0.3);
            margin-bottom: 15px; animation: bounce-slight 2s infinite; display: inline-block; z-index: 50;
        }
        @keyframes bounce-slight { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* Cursor Animation for AI Typing */
        .typing-cursor::after {
            content: 'â–‹';
            animation: blink 1s step-end infinite;
            color: #a3e635;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Battle Mode Styles */
        .battle-card { background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%); border: 1px solid #334155; }
        .vs-badge { 
            background: linear-gradient(45deg, #ff0055, #ff5500); color: white; 
            font-weight: 900; font-style: italic; padding: 5px 15px; border-radius: 20px;
            box-shadow: 0 0 10px rgba(255, 0, 85, 0.5); transform: skew(-10deg);
        }

        /* Result Viewers */
        .viewer-code {
            font-family: 'JetBrains Mono', monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            border-radius: 0.5rem;
            padding: 1rem;
            border: 1px solid #3c3c3c;
            position: relative;
        }
        .viewer-code::before {
            content: 'â— â— â—';
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 10px;
            color: #555;
            letter-spacing: 2px;
        }
        .viewer-doc {
            background-color: #ffffff;
            color: #333333;
            padding: 2rem;
            border-radius: 0.25rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-family: 'Noto Sans KR', serif;
            line-height: 1.8;
            min-height: 200px;
        }
        .viewer-image {
            background-color: #000;
            border-radius: 0.5rem;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            border: 1px solid #333;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="p-4 md:p-8 max-w-7xl mx-auto min-h-screen">

    <!-- Header -->
    <header class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-gray-700 pb-4">
        <div>
            <h1 class="text-3xl font-bold text-white mb-1">PromptCraft <span class="text-[#a3e635]">7.5</span></h1>
            <p class="text-gray-400 text-xs">PECS ì—°êµ¬ìš© ë‹¤ì°¨ì› ì‹¤í—˜ ë„êµ¬ (3 Levels x 3 Domains)</p>
        </div>
        <div class="flex gap-2">
            <div class="px-3 py-1 bg-blue-900/50 text-blue-200 text-xs font-bold rounded border border-blue-500 flex items-center gap-2">
                <i class="fas fa-flask"></i> ì‹¤í—˜ ëª¨ë“œ í™œì„±í™” (ì¤€ì‹¤í—˜ ì„¤ê³„)
            </div>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- LEFT: Intervention Area -->
        <div class="lg:col-span-2 space-y-4">
            <div class="card space-y-4 relative">
                
                <!-- Domain Tabs -->
                <div class="flex gap-2 mb-2 bg-gray-900 p-1 rounded-lg w-fit">
                    <button onclick="switchDomain('text')" id="domain-text" class="domain-tab active"><i class="fas fa-pen-nib mr-1"></i> ê¸€ì“°ê¸°</button>
                    <button onclick="switchDomain('image')" id="domain-image" class="domain-tab"><i class="fas fa-image mr-1"></i> ì´ë¯¸ì§€</button>
                    <button onclick="switchDomain('code')" id="domain-code" class="domain-tab"><i class="fas fa-code mr-1"></i> ì½”ë”©</button>
                </div>

                <!-- Level Tabs -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-3 mb-2">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <span id="level-indicator" class="bg-[#a3e635] text-black w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span> 
                        <span id="level-title">êµ¬ì¡°í™” ê°€ì´ë“œ (Scaffolding)</span>
                    </h2>
                    <div class="flex gap-2">
                        <button onclick="setLevel(1)" id="tab-lv1" class="level-tab active">Lv.1 ì´ˆê¸‰</button>
                        <button onclick="setLevel(2)" id="tab-lv2" class="level-tab inactive">Lv.2 ì¤‘ê¸‰</button>
                        <button onclick="setLevel(3)" id="tab-lv3" class="level-tab inactive">Lv.3 Battle</button>
                    </div>
                </div>
                
                <!-- Dynamic Guide Area -->
                <div id="scaffolding-wrapper" class="relative">
                    <div id="guide-bubble" class="guide-bubble hidden z-20">
                        <!-- Dynamic Guide Text -->
                    </div>
                    
                    <div id="scaffolding-area" class="bg-gray-800 p-4 rounded-lg border border-gray-700 min-h-[320px] relative overflow-hidden transition-all duration-300">
                        <div id="scaffolding-content" class="h-full flex flex-col justify-center">
                            <!-- Content injected by JS -->
                        </div>
                    </div>
                </div>

                <!-- Prompt Input Area -->
                <div class="relative">
                    <div class="flex justify-between items-end mb-2">
                        <label class="block text-gray-400 text-sm font-bold">âœï¸ í”„ë¡¬í”„íŠ¸ ì‘ì„±</label>
                        <button id="edit-toggle-btn" onclick="toggleEditMode()" class="text-xs text-gray-500 underline hover:text-[#a3e635] hidden">ì§ì ‘ ìˆ˜ì •í•˜ê¸°</button>
                    </div>
                    <textarea id="user-input" rows="4" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-4 text-white focus:border-[#a3e635] outline-none text-lg transition-colors duration-300 font-mono leading-relaxed" placeholder="ìœ„ ê°€ì´ë“œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš”." readonly></textarea>
                </div>

                <button onclick="submitPrompt()" id="submit-btn" class="btn-primary w-full flex justify-center items-center gap-2" disabled>
                    <i class="fas fa-paper-plane"></i> <span id="submit-btn-text">ê°€ì´ë“œ ì™„ë£Œ ëŒ€ê¸°</span>
                </button>
            </div>

            <!-- Simulation Result -->
            <div class="card min-h-[200px]">
                <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                    <h3 class="text-lg font-bold text-white"><i class="fas fa-robot text-purple-400 mr-2"></i> AI ìƒì„± ê²°ê³¼ (Simulation)</h3>
                    <span id="sim-status" class="text-xs text-gray-500">ëŒ€ê¸° ì¤‘</span>
                </div>
                <!-- Battle Score Area (Hidden by default) -->
                <div id="battle-result" class="hidden mb-4 p-4 bg-gray-900 rounded-lg border border-gray-700">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-400 text-xs">Human Score</span>
                        <div class="vs-badge text-xs">VS</div>
                        <span class="text-[#a3e635] text-xs">AI Score</span>
                    </div>
                    <div class="relative h-4 bg-gray-700 rounded-full overflow-hidden">
                        <div id="human-bar" class="absolute top-0 left-0 h-full bg-blue-500 transition-all duration-1000" style="width: 0%"></div>
                        <div id="ai-bar" class="absolute top-0 right-0 h-full bg-[#a3e635] transition-all duration-1000" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between mt-1 text-xs font-mono">
                        <span id="human-score-text">0</span>
                        <span id="battle-verdict" class="font-bold text-white">CALCULATING...</span>
                        <span id="ai-score-text">0</span>
                    </div>
                </div>

                <!-- Result Container -->
                <div id="result-container" class="w-full">
                     <div id="sim-output" class="text-gray-300 text-sm leading-relaxed markdown-body min-h-[100px] font-mono">
                        í”„ë¡¬í”„íŠ¸ë¥¼  ì „ì†¡í•˜ë©´ ì´ê³³ì— AIì˜ ìƒì„± ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Dashboard (Dependent Variables) -->
        <div class="space-y-6">
            <!-- PECS Analysis -->
            <div class="card relative min-h-[200px]">
                <h3 class="text-sm font-bold text-gray-400 mb-4 flex justify-between">
                    <span>ğŸ“Š PECS ì—­ëŸ‰ ë¶„ì„</span>
                    <span id="score-badge" class="text-xs bg-gray-700 px-2 py-1 rounded text-white hidden">ì ìˆ˜</span>
                </h3>
                <div id="feedback-loading" class="hidden absolute inset-0 flex items-center justify-center bg-gray-900/80 z-20 rounded-lg">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#a3e635] mx-auto mb-2"></div>
                        <span class="text-xs text-[#a3e635]">ë¶„ì„ ì¤‘...</span>
                    </div>
                </div>
                <div id="feedback-content" class="text-sm text-gray-400 space-y-3">
                    <p class="text-xs text-gray-500">í˜„ì¬ ì„ íƒëœ ì˜ì—­:</p>
                    <div id="current-domain-badge" class="inline-block px-2 py-1 bg-blue-900 text-blue-200 text-xs rounded border border-blue-700 mb-2">ğŸ“ ê¸€ì“°ê¸°</div>
                    <hr class="border-gray-700">
                    <p>ì‘ì„±ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ PECS 5ìš”ì†Œ(ëª©í‘œ, ë§¥ë½, ì§€ì‹œ, í˜•ì‹, ê°œì„ )ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- DKT Graph -->
            <div class="card">
                 <h3 class="text-sm font-bold text-gray-400 mb-2">ğŸ“ˆ ì—­ëŸ‰ ì„±ì¥ ì¶”ì´ (DKT)</h3>
                 <div class="h-[150px] w-full">
                     <canvas id="dktChart"></canvas>
                 </div>
            </div>

            <!-- History -->
            <div class="card max-h-[250px] overflow-y-auto">
                <h3 class="text-sm font-bold text-gray-400 mb-2">ğŸ“œ í•™ìŠµ ë¡œê·¸</h3>
                <div id="history-list" class="space-y-2 text-xs">
                    <p class="text-gray-600 text-center py-4">ê¸°ë¡ ì—†ìŒ</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA STRUCTURE (3 Domains x Roles/Contexts/Formats) ---
        const domainData = {
            text: {
                name: "ê¸€ì“°ê¸°",
                icon: "fa-pen-nib",
                roles: ["ë§ˆì¼€í„°", "ì‘ê°€", "ì„ ìƒë‹˜", "ìƒë‹´ì‚¬"],
                relations: {
                    "ë§ˆì¼€í„°": { context: ["ì‹ ì œí’ˆ ì¶œì‹œ", "ì´ë²¤íŠ¸ í™ë³´"], format: ["SNS ê²Œì‹œë¬¼", "ë³´ë„ìë£Œ"] },
                    "ì‘ê°€": { context: ["SF ì†Œì„¤ ë„ì…ë¶€", "ì—ì„¸ì´"], format: ["1ì¸ì¹­ ì‹œì ", "ëŒ€í™”ì²´"] },
                    "ì„ ìƒë‹˜": { context: ["ê³¼í•™ ê°œë… ì„¤ëª…", "ê°€ì •í†µì‹ ë¬¸"], format: ["ì´ˆë“±í•™ìƒ ëˆˆë†’ì´", "ì¹œì ˆí•œ ì–´ì¡°"] },
                    "ìƒë‹´ì‚¬": { context: ["ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬", "ì§„ë¡œ ê³ ë¯¼"], format: ["ê³µê°í•˜ëŠ” ë§íˆ¬", "í•´ê²°ì±… 3ê°€ì§€"] },
                    "default": { context: ["ì¼ë°˜ì  ìƒí™©"], format: ["ììœ  í˜•ì‹"] }
                },
                template: "ë„ˆëŠ” [ì—­í• ]ì´ì•¼. [ìƒí™©/ëª©í‘œ]ë¥¼ ìœ„í•´, [í˜•ì‹]ìœ¼ë¡œ ì‘ì„±í•´ì¤˜."
            },
            image: {
                name: "ì´ë¯¸ì§€ ìƒì„±",
                icon: "fa-image",
                roles: ["ì‚¬ì§„ì‘ê°€", "ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°", "3D ì•„í‹°ìŠ¤íŠ¸", "í™”ê°€"],
                relations: {
                    "ì‚¬ì§„ì‘ê°€": { context: ["ì¸ë¬¼ í¬íŠ¸ë ˆì´íŠ¸", "ë„ì‹œ ì•¼ê²½"], format: ["85mm ë Œì¦ˆ", "ìì—°ê´‘"] },
                    "ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´í„°": { context: ["íŒíƒ€ì§€ ìºë¦­í„°", "ë™í™” ì‚½í™”"], format: ["ì§€ë¸Œë¦¬ ìŠ¤íƒ€ì¼", "íŒŒìŠ¤í…”í†¤"] },
                    "3D ì•„í‹°ìŠ¤íŠ¸": { context: ["ì‚¬ì´ë²„í‘í¬ ë„ì‹œ", "ì œí’ˆ ë Œë”ë§"], format: ["Unreal Engine 5", "ë„¤ì˜¨ ì¡°ëª…"] },
                    "í™”ê°€": { context: ["í•´ë°”ë¼ê¸° ë°­", "ìí™”ìƒ"], format: ["ê³ í ìŠ¤íƒ€ì¼", "ìœ í™” ì§ˆê°"] },
                    "default": { context: ["í’ê²½"], format: ["ê³ í™”ì§ˆ"] }
                },
                template: "[ì—­í• /ìŠ¤íƒ€ì¼]ì˜ ì´ë¯¸ì§€. [ìƒí™©/í”¼ì‚¬ì²´]ë¥¼ ë¬˜ì‚¬í•´ì¤˜. ì„¸ë¶€ì‚¬í•­: [í˜•ì‹/ì¡°ëª…/êµ¬ë„]."
            },
            code: {
                name: "ì½”ë”©",
                icon: "fa-code",
                roles: ["Python ê°œë°œì", "React ì „ë¬¸ê°€", "ë°ì´í„° ë¶„ì„ê°€", "ë³´ì•ˆ ì „ë¬¸ê°€"],
                relations: {
                    "Python ê°œë°œì": { context: ["ì›¹ í¬ë¡¤ëŸ¬", "ì—…ë¬´ ìë™í™”"], format: ["íš¨ìœ¨ì ì¸ ì½”ë“œ", "ì£¼ì„ í¬í•¨"] },
                    "React ì „ë¬¸ê°€": { context: ["ë¡œê·¸ì¸ í¼", "ëŒ€ì‹œë³´ë“œ"], format: ["Tailwind CSS", "Hooks ì‚¬ìš©"] },
                    "ë°ì´í„° ë¶„ì„ê°€": { context: ["ë§¤ì¶œ ë°ì´í„° ë¶„ì„", "ì‹œê°í™”"], format: ["Pandas ì‚¬ìš©", "ê·¸ë˜í”„ ì½”ë“œ"] },
                    "ë³´ì•ˆ ì „ë¬¸ê°€": { context: ["ì·¨ì•½ì  ì ê²€", "ì•”í˜¸í™”"], format: ["ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€", "ìƒì„¸ ì„¤ëª…"] },
                    "default": { context: ["ê¸°ëŠ¥ êµ¬í˜„"], format: ["Clean Code"] }
                },
                template: "ë„ˆëŠ” [ì—­í• ]ì´ì•¼. [ìƒí™©/ê¸°ëŠ¥]ì„ êµ¬í˜„í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ì¤˜. ì¡°ê±´: [í˜•ì‹/ì œì•½ì‚¬í•­]."
            }
        };

        // --- STATE ---
        let currentDomain = 'text';
        let currentLevel = 1;
        let currentSelection = { role: null, context: null, format: null };
        let dktChartInst = null;
        let dktScores = [50]; // Initial score
        let historyData = [];

        // --- INIT ---
        window.onload = function() {
            initDKT();
            renderUI();
            window.addEventListener('resize', () => { if(currentLevel===1) drawMindMapLines(); });
        };

        // --- CHART.JS IMPLEMENTATION ---
        function initDKT() {
            const ctx = document.getElementById('dktChart').getContext('2d');
            dktChartInst = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Start'],
                    datasets: [{
                        label: 'PECS ì—­ëŸ‰ ì ìˆ˜',
                        data: dktScores,
                        borderColor: '#a3e635',
                        backgroundColor: 'rgba(163, 230, 53, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#0f172a',
                        pointBorderColor: '#a3e635',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false, min: 40, max: 100, grid: { color: '#334155' }, ticks: { color: '#94a3b8' } },
                        x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                    }
                }
            });
        }

        function updateDKT(newScore) {
            if (!dktChartInst) return;
            dktScores.push(newScore);
            const labels = dktScores.map((_, i) => i === 0 ? 'Start' : `Try ${i}`);
            dktChartInst.data.labels = labels;
            dktChartInst.data.datasets[0].data = dktScores;
            dktChartInst.update();
        }

        // --- UI CONTROLS ---
        function switchDomain(domain) {
            currentDomain = domain;
            currentSelection = { role: null, context: null, format: null };
            
            // Update Domain Tabs
            ['text', 'image', 'code'].forEach(d => {
                const btn = document.getElementById(`domain-${d}`);
                if(d === domain) btn.classList.add('active', 'bg-blue-600', 'text-white');
                else btn.classList.remove('active', 'bg-blue-600', 'text-white');
            });

            // Update Badge
            const dData = domainData[domain];
            document.getElementById('current-domain-badge').innerHTML = `<i class="fas ${dData.icon} mr-1"></i> ${dData.name}`;
            
            // Reset Simulation Area Style based on domain
            const simOutput = document.getElementById('sim-output');
            simOutput.innerHTML = "í”„ë¡¬í”„íŠ¸ë¥¼ ì „ì†¡í•˜ë©´ ì´ê³³ì— AIì˜ ìƒì„± ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
            simOutput.className = "text-gray-300 text-sm leading-relaxed markdown-body min-h-[100px] font-mono";

            renderUI();
        }

        function setLevel(lv) {
            currentLevel = lv;
            currentSelection = { role: null, context: null, format: null };
            document.getElementById('user-input').value = "";
            
            // Update Level Tabs
            for(let i=1; i<=3; i++) {
                const btn = document.getElementById(`tab-lv${i}`);
                if(i === lv) {
                    btn.classList.add('active');
                    btn.classList.remove('inactive');
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('inactive');
                }
            }
            
            const titles = ["êµ¬ì¡°í™” ê°€ì´ë“œ (Scaffolding)", "í…œí”Œë¦¿ í™œìš© (Template)", "âš”ï¸ Human vs AI (Battle Mode)"];
            document.getElementById('level-title').innerText = titles[lv-1];
            document.getElementById('level-indicator').innerText = lv;

            // Reset Battle Area
            document.getElementById('battle-result').classList.add('hidden');
            
            renderUI();
        }

        function toggleEditMode() {
            const input = document.getElementById('user-input');
            input.readOnly = !input.readOnly;
            const btn = document.getElementById('edit-toggle-btn');
            if(!input.readOnly) {
                input.focus();
                input.classList.add('border-[#a3e635]');
                btn.innerText = "í¸ì§‘ ì™„ë£Œ";
            } else {
                input.classList.remove('border-[#a3e635]');
                btn.innerText = "ì§ì ‘ ìˆ˜ì •í•˜ê¸°";
            }
        }

        // --- MAIN RENDERER ---
        function renderUI() {
            const content = document.getElementById('scaffolding-content');
            const bubble = document.getElementById('guide-bubble');
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-btn-text');
            const editBtn = document.getElementById('edit-toggle-btn');
            const input = document.getElementById('user-input');

            content.innerHTML = "";
            
            // Level 1: Mind Map
            if (currentLevel === 1) {
                bubble.classList.remove('hidden');
                submitBtn.disabled = true;
                submitText.innerText = "ê°€ì´ë“œë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”";
                editBtn.classList.remove('hidden');
                input.readOnly = true;
                renderMindMap(content);
                updateGuideBubble();
            } 
            // Level 2: Template
            else if (currentLevel === 2) {
                bubble.classList.add('hidden');
                submitBtn.disabled = false;
                submitText.innerText = "í…œí”Œë¦¿ ê¸°ë°˜ ìƒì„±";
                editBtn.classList.add('hidden'); // Auto-editable
                input.readOnly = false;
                const tpl = domainData[currentDomain].template;
                content.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center p-6">
                        <i class="fas fa-shapes text-4xl text-gray-600 mb-4"></i>
                        <h3 class="text-lg font-bold text-white mb-2">ë¹ˆì¹¸ ì±„ìš°ê¸° í…œí”Œë¦¿</h3>
                        <p class="text-sm text-gray-400 mb-6">ì•„ë˜ í…œí”Œë¦¿ì„ í´ë¦­í•˜ì—¬ ë³µì‚¬í•œ í›„, [ ] ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì„¸ìš”.</p>
                        <div onclick="document.getElementById('user-input').value='${tpl}'; document.getElementById('user-input').focus();" 
                             class="bg-gray-700 hover:bg-gray-600 hover:border-[#a3e635] border border-dashed border-gray-500 p-4 rounded-lg cursor-pointer transition w-full max-w-lg group">
                            <p class="font-mono text-gray-300 group-hover:text-white transition">${tpl}</p>
                            <p class="text-xs text-[#a3e635] mt-2 font-bold"><i class="fas fa-copy"></i> í´ë¦­í•˜ì—¬ ì ìš©</p>
                        </div>
                    </div>
                `;
            } 
            // Level 3: Battle Mode (Human vs AI)
            else {
                bubble.classList.add('hidden');
                submitBtn.disabled = false;
                submitText.innerText = "âš”ï¸ AIì™€ ëŒ€ê²°í•˜ê¸°";
                editBtn.classList.add('hidden');
                input.readOnly = false;
                input.placeholder = "ììœ ë¡­ê²Œ í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”. AIê°€ ìµœì í™”ëœ í”„ë¡¬í”„íŠ¸ì™€ ëŒ€ê²°ì„ ì‹ ì²­í•©ë‹ˆë‹¤.";

                content.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center p-6 battle-card">
                        <div class="vs-badge text-2xl mb-4 animate-pulse">Human vs AI</div>
                        <h3 class="text-lg font-bold text-white mb-2">í”„ë¡¬í”„íŠ¸ ë°°í‹€ ëª¨ë“œ</h3>
                        <p class="text-sm text-gray-400">ë‹¹ì‹ ì˜ í”„ë¡¬í”„íŠ¸ vs AIê°€ ìµœì í™”í•œ í”„ë¡¬í”„íŠ¸</p>
                        <p class="text-xs text-gray-500 mt-2">ëˆ„ê°€ ë” PECS ì ìˆ˜ê°€ ë†’ì„ê¹Œìš”? ìŠ¹ë¦¬í•˜ë©´ AIê°€ ë‹¹ì‹ ì˜ í”„ë¡¬í”„íŠ¸ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.</p>
                    </div>
                `;
            }
        }

        // --- MIND MAP LOGIC (Lv 1) ---
        function renderMindMap(area) {
            const data = domainData[currentDomain];
            
            area.innerHTML = `
                <div class="mindmap-wrapper relative flex justify-between items-start h-full p-4 overflow-x-auto gap-4">
                    <svg id="mindmap-svg" class="absolute inset-0 w-full h-full pointer-events-none" style="z-index: 0;"></svg>
                    <!-- Col 1: Role -->
                    <div class="mindmap-col z-10 focus-col" id="col-1-wrap">
                        <span class="text-[#a3e635] text-xs font-bold mb-2 text-center bg-gray-900/80 rounded p-1 border border-gray-700">1. ì—­í•  (Who)</span>
                        <div id="col-role" class="flex flex-col gap-2"></div>
                    </div>
                    <!-- Col 2: Context -->
                    <div class="mindmap-col z-10 blur-col" id="col-2-wrap">
                        <span class="text-[#a3e635] text-xs font-bold mb-2 text-center bg-gray-900/80 rounded p-1 border border-gray-700">2. ìƒí™© (Context)</span>
                        <div id="col-context" class="flex flex-col gap-2"></div>
                    </div>
                    <!-- Col 3: Format -->
                    <div class="mindmap-col z-10 blur-col" id="col-3-wrap">
                        <span class="text-[#a3e635] text-xs font-bold mb-2 text-center bg-gray-900/80 rounded p-1 border border-gray-700">3. í˜•ì‹ (Format)</span>
                        <div id="col-format" class="flex flex-col gap-2"></div>
                    </div>
                </div>`;

            const createNode = (text, active) => {
                const div = document.createElement('div');
                div.className = `mindmap-node ${active ? 'active' : ''}`;
                div.innerText = text;
                return div;
            };

            const roleCol = document.getElementById('col-role');
            data.roles.forEach((r, idx) => {
                const el = createNode(r, currentSelection.role === r);
                el.id = `node-role-${idx}`; 
                el.onclick = () => selectNode('role', r, idx);
                roleCol.appendChild(el);
            });

            if(currentSelection.role) {
                document.getElementById('col-2-wrap').classList.remove('blur-col', 'opacity-30');
                const rel = data.relations[currentSelection.role] || data.relations['default'];
                const ctxCol = document.getElementById('col-context');
                rel.context.forEach((c, idx) => {
                    const el = createNode(c, currentSelection.context === c);
                    el.id = `node-ctx-${idx}`; el.onclick = () => selectNode('context', c, idx);
                    ctxCol.appendChild(el);
                });
            }

            if(currentSelection.context) {
                document.getElementById('col-3-wrap').classList.remove('blur-col', 'opacity-30');
                const rel = data.relations[currentSelection.role] || data.relations['default'];
                const fmtCol = document.getElementById('col-format');
                rel.format.forEach((f, idx) => {
                    const el = createNode(f, currentSelection.format === f);
                    el.id = `node-fmt-${idx}`; el.onclick = () => selectNode('format', f, idx);
                    fmtCol.appendChild(el);
                });
            }
            setTimeout(drawMindMapLines, 100);
        }

        function selectNode(type, value, idx) {
            if(type === 'role') {
                currentSelection = { role: value, context: null, format: null, roleIdx: idx };
            } else if(type === 'context') {
                currentSelection.context = value; currentSelection.contextIdx = idx; currentSelection.format = null;
            } else if(type === 'format') {
                currentSelection.format = value; currentSelection.formatIdx = idx;
            }
            updatePrompt();
            renderScaffolding(); 
        }

        function renderScaffolding() {
            renderMindMap(document.getElementById('scaffolding-content'));
            updateGuideBubble();
        }

        function updateGuideBubble() {
            const guide = document.getElementById('guide-bubble');
            const submitBtn = document.getElementById('submit-btn');
            
            if (!currentSelection.role) {
                guide.innerHTML = `ğŸ‘‡ <strong>1ë‹¨ê³„:</strong> ${domainData[currentDomain].name} <strong>ì—­í• </strong>ì„ ì„ íƒí•˜ì„¸ìš”.`;
            } else if (!currentSelection.context) {
                guide.innerHTML = "ğŸ‘‡ <strong>2ë‹¨ê³„:</strong> êµ¬ì²´ì ì¸ <strong>ìƒí™©/ì£¼ì œ</strong>ëŠ” ë¬´ì—‡ì¸ê°€ìš”?";
            } else if (!currentSelection.format) {
                guide.innerHTML = "ğŸ‘‡ <strong>3ë‹¨ê³„:</strong> ê²°ê³¼ë¬¼ì˜ <strong>í˜•ì‹/ìŠ¤íƒ€ì¼</strong>ì„ ì •í•´ì£¼ì„¸ìš”.";
            } else {
                guide.innerHTML = "âœ¨ <strong>ì™„ë£Œ!</strong> PECS ìš”ì†Œê°€ ëª¨ë‘ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.";
                guide.classList.add('bg-white', 'text-black');
                submitBtn.disabled = false;
                submitBtn.classList.add('animate-bounce');
                document.getElementById('submit-btn-text').innerText = "AI ê²°ê³¼ ìƒì„±í•˜ê¸°";
            }
        }

        function updatePrompt() {
            const {role, context, format} = currentSelection;
            const tpl = domainData[currentDomain].template;
            let text = tpl
                .replace('[ì—­í• ]', role || '[ì—­í• ]')
                .replace('[ì—­í• /ìŠ¤íƒ€ì¼]', role || '[ìŠ¤íƒ€ì¼]')
                .replace('[ìƒí™©/ëª©í‘œ]', context || '[ìƒí™©]')
                .replace('[ìƒí™©/í”¼ì‚¬ì²´]', context || '[í”¼ì‚¬ì²´]')
                .replace('[ìƒí™©/ê¸°ëŠ¥]', context || '[ê¸°ëŠ¥]')
                .replace('[í˜•ì‹]', format || '[í˜•ì‹]')
                .replace('[í˜•ì‹/ì¡°ëª…/êµ¬ë„]', format || '[ì„¸ë¶€ì‚¬í•­]')
                .replace('[í˜•ì‹/ì œì•½ì‚¬í•­]', format || '[ì¡°ê±´]');
            document.getElementById('user-input').value = text;
        }

        function drawMindMapLines() {
            const svg = document.getElementById('mindmap-svg');
            if(!svg) return;
            svg.innerHTML = '';
            const rect = svg.getBoundingClientRect();
            if (rect.width === 0) return;

            const draw = (startId, endPrefix) => {
                const startEl = document.getElementById(startId);
                if(!startEl) return;
                const sR = startEl.getBoundingClientRect();
                const sX = sR.right - rect.left;
                const sY = sR.top + sR.height/2 - rect.top;
                
                document.querySelectorAll(`[id^="${endPrefix}"]`).forEach(endEl => {
                    const eR = endEl.getBoundingClientRect();
                    const eX = eR.left - rect.left;
                    const eY = eR.top + eR.height/2 - rect.top;
                    
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    const c1x = sX + (eX - sX)/2;
                    path.setAttribute("d", `M ${sX} ${sY} C ${c1x} ${sY}, ${c1x} ${eY}, ${eX} ${eY}`);
                    path.setAttribute("fill", "none");
                    path.setAttribute("stroke", endEl.classList.contains('active') ? "#a3e635" : "#475569");
                    path.setAttribute("stroke-width", endEl.classList.contains('active') ? "3" : "1");
                    svg.appendChild(path);
                });
            };
            if(currentSelection.role) draw(`node-role-${currentSelection.roleIdx}`, 'node-ctx-');
            if(currentSelection.context) draw(`node-ctx-${currentSelection.contextIdx}`, 'node-fmt-');
        }

        // --- SUBMIT & SIMULATION LOGIC ---
        function submitPrompt() {
            const text = document.getElementById('user-input').value;
            if(!text) return;

            const btn = document.getElementById('submit-btn');
            const simOutput = document.getElementById('sim-output');
            
            btn.classList.remove('animate-bounce');
            btn.disabled = true;
            document.getElementById('sim-status').innerText = "ìƒì„± ì¤‘...";
            document.getElementById('feedback-loading').classList.remove('hidden');

            // Reset Output for Streaming
            simOutput.innerHTML = "";
            
            // Battle Mode Logic (Level 3)
            if (currentLevel === 3) {
                runBattleSimulation(text);
                return;
            }

            // Normal Mode Logic
            setTimeout(() => {
                const score = Math.floor(Math.random() * 15) + 85;
                updateDKT(score);
                addHistory(score, text);
                
                document.getElementById('score-badge').innerText = `${score}ì `;
                document.getElementById('score-badge').classList.remove('hidden');
                document.getElementById('feedback-loading').classList.add('hidden');
                
                document.getElementById('feedback-content').innerHTML = `
                    <div class="p-2 bg-gray-800 rounded border border-gray-600 mb-2">
                        <strong class="text-[#a3e635] text-xs">PECS ë¶„ì„ ê²°ê³¼</strong>
                        <div class="grid grid-cols-2 gap-2 mt-1 text-xs text-gray-300">
                            <div>ğŸ¯ ëª©í‘œ: <span class="text-blue-400">ëª…í™•í•¨</span></div>
                            <div>ğŸŒ ë§¥ë½: <span class="text-blue-400">êµ¬ì²´ì </span></div>
                        </div>
                    </div>
                    <p class="font-bold text-white text-sm">í›Œë¥­í•œ êµ¬ì¡°ì…ë‹ˆë‹¤!</p>
                `;

                // Render based on domain
                renderDomainResult(text, false);

            }, 1500);
        }

        // --- BATTLE MODE SIMULATION ---
        function runBattleSimulation(userPrompt) {
            const feedbackLoading = document.getElementById('feedback-loading');
            const battleResult = document.getElementById('battle-result');
            const humanBar = document.getElementById('human-bar');
            const aiBar = document.getElementById('ai-bar');
            
            // 1. Show Analyzing UI
            document.getElementById('feedback-content').innerHTML = `
                <div class="text-center py-4">
                    <div class="animate-pulse text-[#a3e635] font-bold">âš ï¸ AIê°€ ë„ì „ì„ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤!</div>
                    <p class="text-xs text-gray-500 mt-2">í”„ë¡¬í”„íŠ¸ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
            `;

            setTimeout(() => {
                feedbackLoading.classList.add('hidden');
                battleResult.classList.remove('hidden');

                // 2. Random Scores
                const humanScore = Math.floor(Math.random() * 20) + 70; // 70-90
                const aiScore = Math.floor(Math.random() * 10) + 88;    // 88-98
                
                // Animate Bars
                setTimeout(() => {
                    humanBar.style.width = `${humanScore}%`;
                    aiBar.style.width = `${aiScore}%`;
                    document.getElementById('human-score-text').innerText = humanScore;
                    document.getElementById('ai-score-text').innerText = aiScore;

                    const verdict = document.getElementById('battle-verdict');
                    const winner = humanScore >= aiScore ? "HUMAN WIN!" : "AI WIN!";
                    verdict.innerText = winner;
                    verdict.className = humanScore >= aiScore ? "font-bold text-blue-400" : "font-bold text-[#a3e635]";
                    
                    updateDKT(humanScore);
                    addHistory(humanScore, userPrompt + " (Battle)");
                    document.getElementById('score-badge').innerText = `${humanScore}ì `;
                    document.getElementById('score-badge').classList.remove('hidden');

                }, 500);

                // 3. Show Winner's Output
                setTimeout(() => {
                    const simOutput = document.getElementById('sim-output');
                    let promptToUse = userPrompt;
                    let message = "";
                    
                    if (humanScore >= aiScore) {
                        message = `<div class='mb-2 text-[#a3e635] font-bold'>ğŸ† Human Victory! ë‹¹ì‹ ì˜ í”„ë¡¬í”„íŠ¸ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</div>`;
                    } else {
                        message = `<div class='mb-2 text-blue-400 font-bold'>ğŸ¤– AI Victory! AI ìµœì í™” í”„ë¡¬í”„íŠ¸ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</div>`;
                        // AI optimize prompt simulation
                        promptToUse += " detailed, high quality, step-by-step";
                    }
                    
                    document.getElementById('sim-status').innerText = "ìƒì„± ì¤‘...";
                    const resultContainer = document.getElementById('sim-output');
                    resultContainer.innerHTML = message;
                    
                    // Render Result
                    renderDomainResult(promptToUse, true); // Append mode

                }, 2000);

            }, 1500);
        }

        // --- DOMAIN SPECIFIC RENDERING ---
        function renderDomainResult(prompt, append = false) {
            const container = document.getElementById('sim-output');
            const btn = document.getElementById('submit-btn');

            if (!append) container.innerHTML = ""; // Clear if not appending

            if (currentDomain === 'image') {
                // ğŸ–¼ï¸ IMAGE DOMAIN: Real AI Generation
                const promptEncoded = encodeURIComponent(prompt);
                const imageUrl = `https://image.pollinations.ai/prompt/${promptEncoded}`;
                
                const imgContainer = document.createElement('div');
                imgContainer.className = "viewer-image";
                imgContainer.innerHTML = `<div class="text-center"><i class="fas fa-spinner fa-spin text-3xl text-gray-500 mb-2"></i><p class="text-xs text-gray-500">AIê°€ ì´ë¯¸ì§€ë¥¼ ê·¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...</p></div>`;
                container.appendChild(imgContainer);

                const img = new Image();
                img.src = imageUrl;
                img.onload = () => {
                    imgContainer.innerHTML = "";
                    img.className = "max-w-full h-auto rounded fade-in";
                    img.style.animation = "fadeIn 1s";
                    imgContainer.appendChild(img);
                    document.getElementById('sim-status').innerText = "ì™„ë£Œ";
                    btn.disabled = false;
                };
                img.onerror = () => {
                    imgContainer.innerHTML = `<p class="text-red-500">ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>`;
                    btn.disabled = false;
                }

            } else if (currentDomain === 'text') {
                // ğŸ“ TEXT DOMAIN: Document Viewer
                const docContainer = document.createElement('div');
                docContainer.className = "viewer-doc mt-2";
                container.appendChild(docContainer);
                
                const response = generateTextResponse(prompt);
                typeWriterEffect(docContainer, response, true); // true for markdown parsing

            } else if (currentDomain === 'code') {
                // ğŸ’» CODE DOMAIN: IDE Viewer
                const codeContainer = document.createElement('div');
                codeContainer.className = "viewer-code mt-2";
                codeContainer.innerHTML = `<div class="text-xs text-gray-500 mb-2 border-b border-gray-700 pb-1 ml-12">main.py</div><div id="code-content"></div>`;
                container.appendChild(codeContainer);
                
                const response = generateCodeResponse(prompt);
                const codeContent = codeContainer.querySelector('#code-content');
                typeWriterEffect(codeContent, response, false); // false for raw text (colored later if needed, but simple for now)
            }
        }

        function generateTextResponse(input) {
            const keywords = input.split(' ').filter(w => w.length > 1).slice(0, 3).join(', ');
            return `## ğŸ“„ ìš”ì²­í•˜ì‹  ë‚´ìš© ì´ˆì•ˆ

**ì£¼ì œ**: ${keywords || 'ì…ë ¥í•˜ì‹  ì£¼ì œ'}

ì„œë¡ :
ìµœê·¼ ${keywords}ì— ëŒ€í•œ ê´€ì‹¬ì´ ë†’ì•„ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ì— ëŒ€í•œ ì²´ê³„ì ì¸ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë³¸ë¡ :
1. **ì¤‘ìš”ì„±**: ì´ ì£¼ì œëŠ” í˜„ëŒ€ ì‚¬íšŒì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.
2. **í•´ê²° ë°©ì•ˆ**: êµ¬ì²´ì ì¸ ë°ì´í„°ì™€ ì‚¬ë¡€ë¥¼ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íš¨ìœ¨ì„±ì„ 30% ì´ìƒ ì¦ëŒ€ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **ì ìš©ì **: ì‹¤ë¬´ì— ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ 3ê°€ì§€ íŒì„ ì œì•ˆí•©ë‹ˆë‹¤.

ê²°ë¡ :
ìš”ì•½í•˜ìë©´, ì§€ì†ì ì¸ ê´€ì‹¬ê³¼ ì‹¤í–‰ì´ ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.

---
*AIê°€ ${new Date().toLocaleDateString()}ì— ìƒì„±í•¨*`;
        }

        function generateCodeResponse(input) {
            return `import pandas as pd
import numpy as np

def process_data(data):
    """
    ${input.substring(0, 10)}... ì²˜ë¦¬ë¥¼ ìœ„í•œ í•¨ìˆ˜
    """
    print("Initializing AI core...")
    
    # ë°ì´í„° ì „ì²˜ë¦¬
    df = pd.DataFrame(data)
    df = df.dropna()
    
    # ë¶„ì„ ë¡œì§ ì‹¤í–‰
    result = df.describe()
    return result

if __name__ == "__main__":
    # ì‹¤í–‰ ì˜ˆì‹œ
    raw_data = load_dataset()
    print("Processing started...")
    final_output = process_data(raw_data)
    print("Done.")`;
        }

        function typeWriterEffect(element, text, isMarkdown) {
            let i = 0;
            element.innerHTML = "";
            element.classList.add('font-mono', 'whitespace-pre-wrap', 'text-sm'); 
            
            function type() {
                if (i < text.length) {
                    let char = text.charAt(i);
                    element.innerHTML += char === '\n' ? '<br>' : char;
                    i++;
                    element.scrollTop = element.scrollHeight;
                    setTimeout(type, Math.random() * 15 + 5); 
                } else {
                    document.getElementById('sim-status').innerText = "ì™„ë£Œ";
                    document.getElementById('submit-btn').disabled = false;
                    
                    if(isMarkdown) {
                         element.innerHTML = marked.parse(text);
                         element.classList.remove('font-mono', 'whitespace-pre-wrap');
                    } else {
                        // Simple Syntax Highlighting simulation for code
                        let html = element.innerHTML;
                        html = html.replace(/def /g, '<span class="text-purple-400">def </span>');
                        html = html.replace(/import /g, '<span class="text-purple-400">import </span>');
                        html = html.replace(/return /g, '<span class="text-purple-400">return </span>');
                        html = html.replace(/print/g, '<span class="text-yellow-300">print</span>');
                        html = html.replace(/".*?"/g, '<span class="text-green-400">$&</span>');
                        html = html.replace(/#.*/g, '<span class="text-gray-500">$&</span>');
                        element.innerHTML = html;
                    }
                }
            }
            type();
        }

        function addHistory(score, text) {
            const historyList = document.getElementById('history-list');
            const historyItem = document.createElement('div');
            historyItem.className = 'p-2 bg-gray-800 rounded border border-gray-700';
            historyItem.innerHTML = `<span class="text-[#a3e635] font-bold">${score}ì </span> <span class="text-gray-400 text-xs truncate block">${new Date().toLocaleTimeString()} - ${text.substring(0, 15)}...</span>`;
            
            if(historyList.children[0] && historyList.children[0].innerText === "ê¸°ë¡ ì—†ìŒ") {
                historyList.innerHTML = '';
            }
            historyList.prepend(historyItem);
        }
    </script>
</body>
</html>